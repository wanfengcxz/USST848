[TOC]



# 专题

## 1.甘特图

## 2.进程/作业调度算法

作业号 提交时间 运行时间 开始时间 等待时间 完成时间 周转时间 带权周转时间

RR中，如果当前进程执行完后，有新的进程到来，应先把新到的进程放入等待队列，再把当前进程放入等待队列

## 3.信号量

semaphore mutex=1; x

P() V()

## 4.银行家算法

Work Need Allocation Work+Allocation

## 5.基本分页/分段系统

绝对地址为0000AC2DH

或者4096B

## 6.请求分页系统（页面调度算法）

访问页面 物理块1 物理块2 物理块3 是否缺页 缺页次数

## 7.磁盘调度算法

FCFS SSTF SCAN  C-SCAN LOOK C-LOOK

## 8.位示图 磁盘块

块号从0开始编号，字号和位号也都从0开始编号

若无提示i j从1开始编号

# 1 计算机系统概述

### 操作系统的定义

操作系统是指控制和管理整个计算机系统的硬件与软件资源，合理地组织，调度计算机的工作与资源的分配，进而为用户和其他软件提供方便接口与环境的程序的集合。

### 操作系统的四大特性

操作系统基本特性包括：并发，共享，虚拟，异步

1. 并发：两个或多个事件在同一时间间隔内发生（计算机系统中同时存在多个运行的程序）
2. 共享：系统中的资源可供内存中多个并发执行的进程共同使用
3. 虚拟：把一个物理上的实体变为若干个逻辑上的对应物
4. 异步：多道程序环境下允许多个程序并发执行，但由于资源有限，进程的执行并不是一贯到底的，而是走走停停，以不可预知的速度向前推进。

把一段时间内只允许一个进程访问的资源称为临界资源

互斥共享：一段时间内只允许一个进程访问该资源

同时访问：若干个用户同时访问该文件

操作系统利用了多种虚拟技术来实现虚拟处理器，虚拟内存，虚拟外部设备等

操作系统的虚拟技术可归纳为：时分复用技术，如处理器的分时共享；空分复用技术，如虚拟存储器

### 操作系统的目标和功能

处理机管理，存储器管理，设备管理，文件管理。

### 操作系统作为计算机系统资源的管理者

### 处理机管理（又叫进程管理）

任务：进程何时创建，何时撤销，如何管理，如何避免冲突，合理共享。

功能：主要包括进程控制，进程调度，进程通信，进程同步，死锁处理。

### 存储器管理 存 射 保 扩

任务：给多道程序的运行提供良好的环境，方便用户使用及提高内存的利用率

功能：内存分配与回收 地址映射 内存保护与共享 内存扩充

### 文件管理

任务：对用户文件和系统文件进行组织管理，以方便用户使用，并保证文件的安全性

功能：文件存储空间的管理，目录管理，文件读写管理和保护

### 设备管理

任务：完成用户的IO请求，方便用户使用各种设备，并提高设备的利用率

功能：缓冲管理，设备分配，设备处理，虚拟设备



# 2 进程管理

## 2.1 进程与线程

### 进程

程序段，数据段，PCB构成了进程实体，进程是进程实体的运行过程，是操作系统进行处理机调度和资源分配的基本单位

### 进程的通信

高级通信方法

1. 共享存储 通信的进程之间有一块可以直接访问的共享空间，进程可以直接读写实现进程之间的信息交换
2. 消息传递 进程之间传递格式化的消息
3. 管道通信 通过缓冲区来传递消息



### 进程和线程的比较

1. 调度 线程是调度的基本单位，线程是资源分配的基本单位
2. 拥有资源 进程是资源分配的基本单位，线程不拥有系统资源，但可以使用其隶属进程的系统资源
3. 并发性 不仅进程之间可以并发执行，多个线程之间也可以并发执行
4. 系统开销 系统创建进程的开销远大于创建或撤销线程的开销

## 2.3 进程调度

### 进程调度

在单处理器多道程序环境中，内存中同时存在多个进程，但只有一个处理机，每次一个进程执行完后，需要操作系统通过某种调度算法来从就绪队列中选择一个进程上处理机运行。

### 调度的层次



## 2.3 进程同步

### 原语

原语是指完成某种功能且不可被分割中断执行的操作序列，通常由硬件来实现

## 2.4 死锁

### 死锁概念

死锁的概念：多个进程因竞争资源而造成的一种互相等待的僵局，若无外力作用，这些进程都将无法向前推进。

### 死锁产生的原因

1. 进程对不可剥夺的系统资源的竞争
2. 进程推进顺序非法

### 死锁的处理策略

死锁预防 破坏死锁的必要条件

1. 破坏互斥条件
2. 破坏不可剥夺条件 若一个已经保持某些不可剥夺资源的进程请求新的资源得不到满足时，它必须释放已持有的资源
3. 请求和保持 静态分配法 一次性把进程所需要的所有资源分配给它，如果无法满足，则该进程不能运行
4. 循环等待 顺序资源分配法

死锁避免 银行家算法 **防止系统进入不安全状态**

死锁检测和解除 及时检测出死锁并解除 资源分配图

1. 资源剥夺法
2. 撤销进程法
3. 进程回退法

# 内存管理

## 基本概念

### 内存管理的任务和功能

**给多道程序提供良好的运行环境**，方便用户使用内存，提高内存的利用率。

功能：

1. 内存的分配和回收
2. 地址映射
3. 内存扩充
4. 内存的保护和共享

### 程序装入和链接 ⭐

**编译：由编译程序把源代码编译为多个目标模块**

**链接：由链接程序把编译后形成的一组模块以及所需的库函数链接在一起，形成一个完整的装入模块。**

**装入：由装入程序把装入模块装入内存运行。**

静态链接 在程序运行之前，先将各目标模块及它们所需要的库函数链接成一个完整的可执行程序，以后不再拆开

装入时动态链接 将用户源程序编译后得到一组目标模块，在装入内存时，采取编装入边链接的方式

运行时动态链接 对于某些目标模块的链接，是在程序执行中需要该目标模块时才进行的



## 虚拟内存分配

### 时钟置换算法

简单时钟置换算法：

给每一帧关联一个附加位，称为使用位。页面初次被调入内存或者刚被访问过时，把使用位置为1。把候选帧集合看作一个循环缓冲区，当需要替换一页时，扫描缓冲区，查找使用位被置为0的帧。每遇到使用位为1的帧时，扫描过后就将其置为0.

改进型时钟置换算法

改进型时钟置换算法在使用位的基础上增加了修改位，用来表示当前帧是否被修改，将页面进一步细分为使用过但未修改，使用过且修改过。每次循环扫描缓冲区时，有未使用过则先置换出为使用过，若全部使用过，则优先置换为修改过的页面。

### 驻留集

驻留集是指为当前进程分配的物理页框的结合

### 页面分配策略

固定分配局部置换

可变分配局部置换

可变分配全局置换

### 页面调入时机

预调页策略：根据程序的局部性原理，在程序第一次被调入内存执行时，有程序员指定调入页面的地址信息

请求调页策略：在程序执行过程中，发生缺页中断时，需要调页程序发出调页请求，由操作系统将所需页面调入内存

### 抖动

抖动是指刚刚换出内存的页面又要换入内存，刚刚换入内存的页面又要换出内存。

抖动发生的原因：操作系统给某个进程分配的页面数量小于进程频繁访问的页面数量

# 4 文件管理

## 4.1 文件系统基础

### 什么是文件？

文件是以计算机硬盘为载体存储在计算机上的信息集合，是用户进行输入输出的基本单位。

### 文件打开

系统将文件的属性从外存复制到内存中的文件打开表中，并将该表目的索引返回给用户.

### 文件的逻辑结构和物理结构

逻辑结构:从用户的观点出发看到的文件组织方式

物理结构:从实现的观点出发看到的文件在外存上的存储组织方式

### 逻辑文件的划分

有结构文件,无结构文件

有结构文件:顺序文件,索引文件,索引顺序文件.

1. **顺序文件**:串结构(记录之间的顺序和关键字无关) 顺序结构(记录之间的顺序和关键字有关)
2. **索引文件**:通过建立一张索引表来存储每个记录的长度和地址,加快检索速度
3. **索引顺序文件**:是顺序文件和索引文件的结合,将顺序文件的记录分为若干组,在索引表中为每一组的第一条记录建立一个索引项.各个组内记录可以无序,但组间一定有序.
4. 直接文件:通过哈希函数直接决定记录地址.

### 文件控制块

文件控制块是存放控制文件所需信息的数据结构，主要信息有：

1. 文件的基本信息。文件名，文件物理位置
2. 存储控制信息。文件的读写权限
3. 使用信息。修改时间，创建时间 

### 索引节点

将文件的描述信息放入索引节点中，目录项仅由文件名和对应索引节点的地址构成

提高了对目录的检索速度

### 目录结构

1. **单级目录**：在整个文件系统中只建立一张目录表，每个文件对应一个目录项 查找速度慢，不允许文件重名，不利于文件共享
2. **两级目录**：将文件目录分为主文件目录和用户文件目录 不同用户的文件可以重名
3. **多级目录**：两级目录的推广  能够很方便地对文件进行分类，目录结构清晰，不同目录下的文件可以重名，但是在搜索文件时，需要不断读取下一级的文件目录，增加了访问磁盘的次数
4. **有向无环图目录**：在树型目录的基础上加入了指向同一节点的有向边。便于文件共享。

### 共享文件的方法

1. 基于索引节点的共享方式  采用索引节点的方式，目录项只保留文件名和索引节点地址，索引节点中有共享计数器，用来记录指向该文件的用户目录项的个数。
2. 利用符号链实现文件共享  只有文件主才拥有指向该文件索引节点的指针，共享者只拥有该文件的路径名

### 文件保护

文件保护通过**口令保护**，**加密保护**和**访问控制**等方式实现

访问控制：为每个文件增加一张访问控制表，以记录每个用户的访问权限

## 4.2 文件系统的实现

### 文件系统层次结构

**用户调用接口**：为用户提供与文件及目录有关的调用

**文件目录系统**：管理文件目录，管理用户进程的打开文件表

**存取控制验证模块**：实现文件保护功能，检查用户访问权限以确保合法性

**逻辑文件系统与文件信息缓冲区**：根据文件的逻辑结构将用户要读写的逻辑记录转换成文件逻辑结构内的相应块号

**物理文件系统**：把逻辑记录所在的相应块号转换成实际的物理地址

**辅助分配模块&设备管理程序模块**：分配设备，启动设备，分配缓冲区

### 目录的实现

### 文件实现

1. 文件分配方式 对磁盘非空闲块的管理
2. 文件存储空间管理 对磁盘空闲块的管理

### 文件分配方式

**连续分配**：每个文件在磁盘上占有一组连续的块 

1. 优点 支持顺序访问和随机访问 实现简单存取速度快 作业访问磁盘时需要的寻道数和时间最小 
2. 缺点 文件不易动态增长 频繁增删会产生外部碎片

**链接分配**：采用离散的分配方式

1. 优点 增删改方便 显著提高了磁盘空间的利用率（消除了外部碎片）

**隐式** 每个目录项都会有一个指向文件首块的指针，每个文件块都有指向下一个文件块的指针，文件块可以分布在磁盘的任何位置，通过指针依次顺序访问

1. 缺点 不能直接访问 不稳定 容易发生数据丢失 指针占用一定的空间

**显式** 把用于链接文件各物理块的指针从物理块的末尾提取出来，显式地放入内存中的一张链接表中 整个磁盘设置一张 FAT

1. 系统启动后，文件分配表就会被读入内存，提高了检索速度，减少了磁盘的访问次数

**索引分配** 把每个文件的所有物理块号放在一张索引表中

能够直接访问 索引表占用一定的存储空间

1. 链接方案
2. 多层索引
3. 混合索引

### 文件存储空间管理

空闲表法 为系统外存中所有的空闲盘块建立一张空闲盘快表

空闲链表法 将磁盘上所有的空闲盘块链接起来组成一个链表

位示图法

成组链接法

## 4.2 磁盘的组织和管理

一次磁盘读写操作的实践构成

1. 寻道时间
2. 旋转延迟时间 1/2*r
3. 传输时间

# 5 IO管理

### IO控制方式

1. 程序直接控制方式
2. 中断驱动方式
3. DMA方式
4. 通道控制方式

### IO子系统的层次结构

用户层IO软件

设备独立性软件

设备驱动程序

中断处理程序

硬件

### 缓冲区的作用

### 设备分配的原则

既要充分发挥设备的使用效率，使设备尽可能地忙碌，又要避免造成进程死锁

### 设备映射表

建立逻辑设备和物理设备的对应关系

### Spooling技术（假脱机技术

输入井和输出井是在外存上开辟出的存储空间

输入缓冲区和输出缓冲区是在内存中开辟的两个缓冲区

当输入设备输入数据时，输入进程会把数据送入输入缓冲区，然后在传送到输入井中。CPU要读取输入数据时，直接将数据从输入井读入内存。